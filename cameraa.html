<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Polaroid Camera</title>
    <style>
        /* 1. Ï†ÑÏ≤¥ Î∞∞Ïπò */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #ddd;
            background-image: radial-gradient(#bbb 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
            touch-action: manipulation;
        }

        /* 2. Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
        .main-container {
            display: flex;
            align-items: flex-start;
            gap: 30px;
            padding: 20px;
        }

        /* Ïπ¥Î©îÎùº ÏòÅÏó≠ */
        .camera-section {
            position: relative;
            z-index: 20;
        }

        .camera-body {
            width: 300px;
            height: 320px;
            background-color: #fdf5e6;
            border-radius: 40px;
            box-shadow: 15px 15px 35px rgba(0,0,0,0.2);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 4px solid #f0f0f0;
        }

        .lens-ring {
            width: 190px;
            height: 190px;
            background: #d3d3d3;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 5px 5px 15px rgba(0,0,0,0.2);
        }

        .lens-inner {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            background: #000;
            border: 8px solid #333;
        }

        video {
            width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1);
        }

        /* ÏÖîÌÑ∞ Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .shutter-btn {
            position: absolute;
            bottom: 35px; left: 25px;
            width: 50px; height: 50px;
            background-color: #ff7f50;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.1s;
        }
        .shutter-btn:active { transform: scale(0.9); }
        /* ÎπÑÌôúÏÑ±Ìôî(Ï∞çÎäî Ï§ë) ÏÉÅÌÉúÏùº Îïå */
        .shutter-btn.disabled {
            background-color: #ccc;
            pointer-events: none; /* ÌÅ¥Î¶≠ Î∂àÍ∞Ä */
        }

        .print-slot {
            position: absolute;
            top: -10px; left: 50%;
            transform: translateX(-50%);
            width: 160px; height: 12px;
            background: #222;
            border-radius: 6px;
            z-index: 10;
        }

        /* 3. Í∞§Îü¨Î¶¨ Î≥¥Í¥ÄÌï® */
        .gallery-box {
            width: 360px;
            height: 500px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            padding: 20px;
            box-shadow: inset 2px 2px 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 15px;
        }

        .gallery-title {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
            color: #666;
            font-weight: bold;
            font-size: 14px;
            border-bottom: 1px dashed #999;
            padding-bottom: 5px;
        }

        .photo-item {
            width: 100px;
            background: #fff;
            padding: 5px 5px 20px 5px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .photo-item:hover { transform: scale(1.05); z-index: 50; }
        
        .photo-item img {
            width: 100%; height: auto; display: block;
            filter: grayscale(10%);
            background: #000;
        }
        .photo-item .date {
            font-size: 8px; margin-top: 5px; color: #555;
        }

        /* 4. Ïù¥Îèô Ïï†ÎãàÎ©îÏù¥ÏÖòÏö© */
        .flying-photo {
            position: fixed;
            width: 140px;
            background: white;
            padding: 8px 8px 30px 8px;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.3);
            z-index: 999;
            pointer-events: none;
            transform-origin: top left;
        }
        .flying-photo img { width: 100%; display: block; }

        /* 5. ÌôïÎåÄ Î≥¥Í∏∞ Î™®Îã¨ & Ï†ÄÏû• Î≤ÑÌäº */
        .modal {
            display: none; position: fixed; z-index: 2000;
            left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            flex-direction: column;
            justify-content: center; align-items: center;
        }

        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 70vh;
            background: white;
            padding: 15px 15px 50px 15px;
            border-radius: 4px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
        }

        .modal-content img {
            max-width: 100%;
            max-height: 60vh;
            display: block;
        }

        .save-btn {
            margin-top: 20px;
            padding: 12px 30px;
            background-color: #ff7f50;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 127, 80, 0.4);
            display: flex; align-items: center; gap: 8px;
        }
        .save-btn:active { transform: scale(0.95); background-color: #ff6347; }

        .close-msg {
            margin-top: 15px; color: rgba(255,255,255,0.6); font-size: 12px;
        }

        .flash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; opacity: 0; pointer-events: none; z-index: 1000;
        }
        .flash.active { animation: flash 0.15s; }
        @keyframes flash { 0% { opacity: 0.8; } 100% { opacity: 0; } }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column; align-items: center; gap: 20px;
                width: 100%; height: 100vh; padding-top: 20px; box-sizing: border-box;
            }
            .camera-body { transform: scale(0.85); margin-bottom: -20px; }
            .gallery-box {
                width: 90%; flex: 1; height: auto;
                overflow-x: auto; flex-wrap: nowrap;
                align-content: center; align-items: center;
                padding: 10px; background: rgba(255,255,255,0.6);
            }
            .gallery-title { display: none; }
            .photo-item { flex: 0 0 auto; margin-right: 10px; }
        }
    </style>
</head>
<body>
    <div class="flash" id="flash"></div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <img id="modalImg" src="">
            <div style="margin-top:10px; font-size:12px; color:#666; font-family:'Courier New'">#Memory</div>
        </div>
        <button class="save-btn" onclick="downloadPhoto()">üíæ ÏÇ¨ÏßÑ Ï†ÄÏû•ÌïòÍ∏∞</button>
        <div class="close-msg" onclick="closeModal()">[ Îã´Í∏∞: ÌôîÎ©¥Ïùò Îπà Í≥≥ ÌÅ¥Î¶≠ ]</div>
    </div>

    <div class="main-container">
        <div class="camera-section">
            <div class="print-slot" id="printSlot"></div>
            <div class="camera-body">
                <div class="lens-ring">
                    <div class="lens-inner">
                        <video id="video" autoplay playsinline muted></video>
                    </div>
                </div>
                <div class="shutter-btn" id="shutterBtn"></div>
            </div>
        </div>

        <div class="gallery-box" id="gallery">
            <div class="gallery-title">MY PHOTO ALBUM</div>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const shutterBtn = document.getElementById('shutterBtn');
        const gallery = document.getElementById('gallery');
        const printSlot = document.getElementById('printSlot');
        const flash = document.getElementById('flash');
        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modalImg');
        
        let currentPhotoUrl = "";
        let isProcessing = false; // Ï§ëÎ≥µ Ï¥¨ÏòÅ Î∞©ÏßÄÏö© ÍπÉÎ∞ú

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user', width: {ideal: 1280}, height: {ideal: 720} },
                    audio: false
                });
                video.srcObject = stream;
            } catch (err) {
                alert("Ïπ¥Î©îÎùº Ï†ëÍ∑º Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.");
            }
        }

        function takePhoto() {
            // 1. Ïù¥ÎØ∏ Ï∞çÍ≥† ÏûàÎäî Ï§ëÏù¥Î©¥ Î¨¥Ïãú (Ï§ëÎ≥µ Î∞©ÏßÄ ÌïµÏã¨)
            if (isProcessing) return;
            if (video.readyState < 2) return;

            // 2. "Ï∞çÎäî Ï§ë" ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω Î∞è Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            isProcessing = true;
            shutterBtn.classList.add('disabled');

            // 3. ÌîåÎûòÏãú Î∞è Ï¥¨ÏòÅ
            flash.classList.add('active');
            setTimeout(() => flash.classList.remove('active'), 150);

            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0);
            
            const imgUrl = canvas.toDataURL('image/jpeg', 0.9);
            animatePhotoTransfer(imgUrl);

            // 4. 1.2Ï¥à Îí§Ïóê Îã§Ïãú Ï∞çÏùÑ Ïàò ÏûàÍ≤å ÌíÄÏñ¥Ï§å (Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÍ∞ÑÍ≥º ÎπÑÏä∑ÌïòÍ≤å)
            setTimeout(() => {
                isProcessing = false;
                shutterBtn.classList.remove('disabled');
            }, 1200);
        }

        function animatePhotoTransfer(url) {
            const flyer = document.createElement('div');
            flyer.className = 'flying-photo';
            flyer.innerHTML = `<img src="${url}">`;
            document.body.appendChild(flyer);

            const startRect = printSlot.getBoundingClientRect();
            const galleryRect = gallery.getBoundingClientRect();
            const isMobile = window.innerWidth <= 768;

            let targetX = isMobile ? galleryRect.left + 20 : galleryRect.left + 20;
            let targetY = isMobile ? galleryRect.top + 20 : galleryRect.top + 40;

            flyer.animate([
                { top: (startRect.top + 20) + 'px', left: startRect.left + 'px', transform: 'scale(0.8)', opacity: 1, offset: 0 },
                { top: (startRect.top - 80) + 'px', left: startRect.left + 'px', transform: 'scale(1)', opacity: 1, offset: 0.4 },
                { top: targetY + 'px', left: targetX + 'px', transform: 'scale(0.7) rotate(5deg)', opacity: 1, offset: 1 }
            ], { duration: 1200, easing: 'ease-in-out', fill: 'forwards' }).onfinish = () => {
                flyer.remove();
                addPhotoToGallery(url);
            };
        }

        function addPhotoToGallery(url) {
            const item = document.createElement('div');
            item.className = 'photo-item';
            
            const now = new Date();
            const dateStr = `${now.getMonth()+1}/${now.getDate()} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            
            item.innerHTML = `<img src="${url}"><div class="date">${dateStr}</div>`;
            item.onclick = () => openModal(url);

            if(gallery.children.length > 1) {
                 gallery.insertBefore(item, gallery.children[1]);
            } else {
                gallery.appendChild(item);
            }
        }

        function openModal(url) {
            modalImg.src = url;
            currentPhotoUrl = url;
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        modal.addEventListener('click', (e) => {
            if (e.target === modal || e.target.classList.contains('close-msg')) {
                closeModal();
            }
        });

        function downloadPhoto() {
            if (!currentPhotoUrl) return;
            const link = document.createElement('a');
            link.href = currentPhotoUrl;
            const now = new Date();
            const timestamp = `${now.getFullYear()}${now.getMonth()+1}${now.getDate()}_${now.getHours()}${now.getMinutes()}${now.getSeconds()}`;
            link.download = `polaroid_${timestamp}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†ïÎ¶¨: ÌÑ∞ÏπòÏôÄ ÌÅ¥Î¶≠Ïù¥ Ï§ëÎ≥µÎêòÏñ¥ÎèÑ Ìï®Ïàò ÎÇ¥Î∂ÄÏóêÏÑú ÎßâÏïÑÏ§å
        shutterBtn.addEventListener('click', takePhoto);
        shutterBtn.addEventListener('touchstart', (e) => { 
            e.preventDefault(); 
            takePhoto(); 
        });

        startCamera();
    </script>
</body>
</html>
