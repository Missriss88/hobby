<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Rush: Syntax Savior</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel (JSX 변환용) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* 커스텀 스크롤바 스타일 */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e1e1e; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .animate-slide-up { animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    </style>
</head>
<body class="bg-gray-950 text-white h-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // 아이콘 컴포넌트 (Lucide 아이콘 대체용 SVG)
        const Icons = {
            Terminal: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg>,
            Play: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
            RotateCcw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 4v6h6"></path><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>,
            CheckCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>,
            XCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>,
            Code2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>,
            Cpu: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="15" x2="23" y2="15"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="15" x2="4" y2="15"></line></svg>,
            Trophy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 21h8"></path><path d="M12 17v4"></path><path d="M7 4h10"></path><path d="M18 4h3a2 2 0 0 1 2 2v2a5 5 0 0 1-5 5V4Z"></path><path d="M6 4H3a2 2 0 0 0-2 2v2a5 5 0 0 0 5 5V4Z"></path><path d="M12 17a5 5 0 0 0 5-5V4H7v8a5 5 0 0 0 5 5Z"></path></svg>,
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>,
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>,
            Monitor: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>,
            RefreshCw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>,
            User: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        };

        const { Terminal, Play, RotateCcw, CheckCircle, XCircle, Code2, Cpu, Trophy, Activity, Zap, Monitor, RefreshCw, User } = Icons;

        const LANGUAGES = {
            PYTHON: 'Python',
            C: 'C',
            CSHARP: 'C#',
            CPP: 'C++'
        };

        const playSound = (type) => {
            if (typeof window === 'undefined') return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            
            osc.connect(gain);
            gain.connect(ctx.destination);

            const now = ctx.currentTime;
            
            if (type === 'success') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, now);
                osc.frequency.exponentialRampToValueAtTime(1046.5, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'fever') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.linearRampToValueAtTime(880, now + 0.1);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'complete') {
                osc.type = 'triangle';
                [523.25, 659.25, 783.99, 1046.5].forEach((freq, i) => {
                    const o = ctx.createOscillator();
                    const g = ctx.createGain();
                    o.connect(g);
                    g.connect(ctx.destination);
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.1, now + i * 0.1);
                    g.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.4);
                    o.start(now + i * 0.1);
                    o.stop(now + i * 0.1 + 0.4);
                });
            }
        };

        const QUESTIONS_SOURCE = {
            [LANGUAGES.PYTHON]: [
                { context: "Step 1: 데이터 분석 라이브러리 로드", preCode: "", gap: "import", postCode: " pandas as pd\nimport math", options: ["include", "using", "import", "require"], answer: "import", explanation: "라이브러리를 사용할 때는 import 키워드를 씁니다." },
                { context: "Step 2: 데이터셋 파일 열기", preCode: "with ", gap: "open", postCode: "(\"dataset.csv\", \"r\") as f:\n    raw_data = f.readlines()", options: ["file", "load", "open", "read"], answer: "open", explanation: "파일을 안전하게 열 때는 with open(...) 패턴을 사용합니다." },
                { context: "Step 3: 데이터 파싱 (문자열 분리)", preCode: "header = raw_data[0].strip().", gap: "split", postCode: "(\",\")", options: ["slice", "divide", "split", "cut"], answer: "split", explanation: "CSV 데이터를 쉼표 기준으로 나누려면 split을 사용합니다." },
                { context: "Step 4: AI 모델 클래스 정의", preCode: "class AIModel:\n    def ", gap: "__init__", postCode: "(self, learning_rate):\n        self.lr = learning_rate", options: ["__main__", "__init__", "start", "__new__"], answer: "__init__", explanation: "클래스의 초기화 메서드는 __init__입니다." },
                { context: "Step 5: 학습 메서드 정의", preCode: "    ", gap: "def", postCode: " train(self, data):\n        print(\"Training started...\")", options: ["function", "def", "func", "void"], answer: "def", explanation: "함수(메서드) 정의는 def로 시작합니다." },
                { context: "Step 6: 학습 루프 (에포크 반복)", preCode: "        epochs = 10\n        for i in ", gap: "range", postCode: "(epochs):\n            self.optimize()", options: ["loop", "range", "xrange", "list"], answer: "range", explanation: "지정된 횟수만큼 반복하려면 range를 사용합니다." },
                { context: "Step 7: 손실값 기록 (리스트 추가)", preCode: "        history = []\n        history.", gap: "append", postCode: "(current_loss)", options: ["push", "add", "insert", "append"], answer: "append", explanation: "리스트에 값을 추가할 때는 append를 사용합니다." },
                { context: "Step 8: 학습 중단 조건 확인", preCode: "            ", gap: "if", postCode: " current_loss < 0.01:\n                break", options: ["when", "check", "if", "case"], answer: "if", explanation: "조건을 검사할 때는 if문을 사용합니다." },
                { context: "Step 9: 예외 처리 (0으로 나누기 방지)", preCode: "        ", gap: "try", postCode: ":\n            accuracy = correct / total\n        except ZeroDivisionError:\n            accuracy = 0", options: ["try", "attempt", "do", "begin"], answer: "try", explanation: "에러가 발생할 수 있는 코드는 try 블록에 넣습니다." },
                { context: "Step 10: 정확도 반올림", preCode: "        print(f\"Acc: {", gap: "round", postCode: "(accuracy, 4)}\")", options: ["ceil", "floor", "round", "fix"], answer: "round", explanation: "소수점을 정리할 때는 round 함수를 씁니다." },
                { context: "Step 11: 람다 함수로 전처리", preCode: "normalize = ", gap: "lambda", postCode: " x: x / 255.0", options: ["func", "def", "lambda", "arrow"], answer: "lambda", explanation: "간단한 익명 함수는 lambda로 정의합니다." },
                { context: "Step 12: 설정값 존재 확인", preCode: "config = {'batch': 32}\nif 'batch' ", gap: "in", postCode: " config:\n    print(\"Batch size set\")", options: ["has", "in", "exists", "contains"], answer: "in", explanation: "딕셔너리 키 존재 여부는 in 연산자로 확인합니다." },
                { context: "Step 13: 데이터 검증 (모두 통과?)", preCode: "validations = [True, True, True]\nis_valid = ", gap: "all", postCode: "(validations)", options: ["every", "all", "check", "sum"], answer: "all", explanation: "모든 요소가 참인지 확인할 때는 all()을 사용합니다." },
                { context: "Step 14: 데이터셋 크기 확인", preCode: "n_samples = ", gap: "len", postCode: "(raw_data)", options: ["length", "size", "count", "len"], answer: "len", explanation: "리스트나 문자열의 길이는 len()입니다." },
                { context: "Step 15: 결과 출력 및 서버 시작", preCode: "print(\"System Ready\")\n", gap: "print", postCode: "(\"Server listening on port 8080...\")", options: ["printf", "echo", "print", "write"], answer: "print", explanation: "화면에 메시지를 출력할 때는 print를 사용합니다." }
            ],
            [LANGUAGES.C]: [
                { context: "Step 1: 표준 입출력 헤더 포함", preCode: "#include <", gap: "stdio.h", postCode: ">", options: ["iostream", "stdio.h", "std.h", "io.h"], answer: "stdio.h", explanation: "C언어의 표준 입출력 함수들은 stdio.h에 있습니다." },
                { context: "Step 2: 상수 정의 (맵 크기)", preCode: "#", gap: "define", postCode: " MAP_WIDTH 100", options: ["const", "define", "set", "var"], answer: "define", explanation: "매크로 상수는 #define으로 정의합니다." },
                { context: "Step 3: 플레이어 구조체 정의", preCode: "", gap: "struct", postCode: " Player {\n    int x, y;\n    int hp;\n};", options: ["class", "struct", "type", "rec"], answer: "struct", explanation: "데이터를 묶을 때는 구조체(struct)를 사용합니다." },
                { context: "Step 4: 게임 맵 메모리 할당", preCode: "int *map = (int*)", gap: "malloc", postCode: "(sizeof(int) * MAP_WIDTH);", options: ["new", "alloc", "malloc", "mem"], answer: "malloc", explanation: "동적 메모리 할당은 malloc 함수를 사용합니다." },
                { context: "Step 5: 메모리 할당 실패 확인", preCode: "if (map == ", gap: "NULL", postCode: ") {\n    return -1;\n}", options: ["nil", "null", "NULL", "0"], answer: "NULL", explanation: "포인터가 비었음을 확인할 때는 NULL 매크로를 씁니다." },
                { context: "Step 6: 플레이어 이름 복사", preCode: "char name[20];\n", gap: "strcpy", postCode: "(name, \"Hero\");", options: ["strcopy", "cpystr", "strcpy", "move"], answer: "strcpy", explanation: "문자열 대입(복사)은 strcpy 함수를 사용합니다." },
                { context: "Step 7: 구조체 크기 확인", preCode: "int p_size = ", gap: "sizeof", postCode: "(struct Player);", options: ["len", "size", "sizeof", "width"], answer: "sizeof", explanation: "타입의 바이트 크기는 sizeof로 구합니다." },
                { context: "Step 8: 포인터로 초기값 설정", preCode: "struct Player p;\nstruct Player *ptr = ", gap: "&", postCode: "p;\nptr->hp = 100;", options: ["*", "&", "@", "#"], answer: "&", explanation: "변수의 주소값은 & 연산자로 가져옵니다." },
                { context: "Step 9: 메인 게임 루프 시작", preCode: "int running = 1;\n", gap: "while", postCode: "(running) {\n    update_game();\n}", options: ["for", "loop", "until", "while"], answer: "while", explanation: "조건이 참인 동안 반복하려면 while문을 씁니다." },
                { context: "Step 10: 사용자 입력 처리 (포인터)", preCode: "int input;\nscanf(\"%d\", ", gap: "&", postCode: "input);", options: ["*", "&", "$", "ptr"], answer: "&", explanation: "scanf에는 변수의 주소(&)를 넘겨주어야 합니다." },
                { context: "Step 11: 입력에 따른 분기", preCode: "switch(input) {\n    ", gap: "case", postCode: " 1: move_up(); break;\n}", options: ["when", "if", "case", "option"], answer: "case", explanation: "switch문 내부의 조건 분기는 case를 사용합니다." },
                { context: "Step 12: 데미지 처리 (역참조)", preCode: "void hit(int *hp) {\n    ", gap: "*", postCode: "hp -= 10;\n}", options: ["&", "*", "->", "."], answer: "*", explanation: "포인터가 가리키는 값을 수정하려면 * 연산자를 씁니다." },
                { context: "Step 13: 명령어 문자열 비교", preCode: "if (", gap: "strcmp", postCode: "(cmd, \"quit\") == 0) running = 0;", options: ["strequal", "strcmp", "compare", "eq"], answer: "strcmp", explanation: "두 문자열이 같은지 비교할 때는 strcmp를 사용합니다." },
                { context: "Step 14: 상태 정보 출력", preCode: "", gap: "printf", postCode: "(\"HP: %d\\n\", p.hp);", options: ["print", "cout", "printf", "log"], answer: "printf", explanation: "형식화된 출력은 printf를 사용합니다." },
                { context: "Step 15: 종료 및 값 반환", preCode: "free(map);\n", gap: "return", postCode: " 0;", options: ["exit", "back", "return", "out"], answer: "return", explanation: "함수를 종료하고 값을 반환할 때는 return을 씁니다." }
            ],
            [LANGUAGES.CSHARP]: [
                { context: "Step 1: 시스템 라이브러리 사용", preCode: "", gap: "using", postCode: " System;\nusing System.Windows.Forms;", options: ["import", "include", "using", "from"], answer: "using", explanation: "네임스페이스를 가져올 때는 using을 사용합니다." },
                { context: "Step 2: 네임스페이스 선언", preCode: "", gap: "namespace", postCode: " MyApp {\n    // ...\n}", options: ["package", "module", "namespace", "region"], answer: "namespace", explanation: "코드를 그룹화하는 네임스페이스를 선언합니다." },
                { context: "Step 3: 폼 클래스 상속", preCode: "public class LoginForm ", gap: ":", postCode: " Form {\n    // Form Logic\n}", options: ["extends", ":", "implements", "->"], answer: ":", explanation: "C#에서 상속은 콜론(:)을 사용합니다." },
                { context: "Step 4: 상수 타이틀 정의", preCode: "    ", gap: "const", postCode: " string TITLE = \"Login App\";", options: ["final", "static", "const", "readonly"], answer: "const", explanation: "변하지 않는 값은 const로 선언합니다." },
                { context: "Step 5: 연결 상태 열거형 정의", preCode: "    public ", gap: "enum", postCode: " State { Disconnected, Connected }", options: ["type", "enum", "list", "option"], answer: "enum", explanation: "상태 목록을 정의할 때는 enum을 사용합니다." },
                { context: "Step 6: 유저명 프로퍼티 (Getter/Setter)", preCode: "    public string Username { get; ", gap: "set", postCode: "; }", options: ["put", "set", "let", "init"], answer: "set", explanation: "프로퍼티의 값을 설정하는 접근자는 set입니다." },
                { context: "Step 7: 인증 인터페이스 정의", preCode: "    public ", gap: "interface", postCode: " IAuthenticator {\n        bool Validate(string u);\n    }", options: ["class", "struct", "interface", "protocol"], answer: "interface", explanation: "기능의 명세는 interface로 정의합니다." },
                { context: "Step 8: 생성자 및 부모 초기화", preCode: "    public LoginForm() ", gap: ":", postCode: " base() {\n        InitializeComponent();\n    }", options: ["super", "parent", "base", "root"], answer: ":", explanation: "생성자에서 부모 생성자를 호출할 때는 : base()를 씁니다." },
                { context: "Step 9: UI 버튼 객체 생성", preCode: "    Button btn = ", gap: "new", postCode: " Button();", options: ["alloc", "create", "new", "make"], answer: "new", explanation: "객체(인스턴스)를 생성할 때는 new 키워드를 씁니다." },
                { context: "Step 10: 비동기 로그인 메서드", preCode: "    public ", gap: "async", postCode: " void OnLoginClick(object s, EventArgs e)", options: ["await", "async", "sync", "void"], answer: "async", explanation: "비동기 메서드를 선언할 때는 async 키워드를 붙입니다." },
                { context: "Step 11: 타입 추론 변수 선언", preCode: "        ", gap: "var", postCode: " db = new DatabaseConnection();", options: ["let", "auto", "var", "dim"], answer: "var", explanation: "우변에서 타입을 알 수 있을 때 var를 사용합니다." },
                { context: "Step 12: 환영 메시지 (문자열 보간)", preCode: "        string msg = ", gap: "$", postCode: "\"Welcome, {Username}!\";", options: ["@", "$", "#", "%"], answer: "$", explanation: "문자열 내 변수를 쓰려면 $를 앞에 붙입니다." },
                { context: "Step 13: 널 조건부 연산자", preCode: "        int? len = Username", gap: "?.", postCode: "Length;", options: [".", "?.", "!!", "??"], answer: "?.", explanation: "객체가 null일 수 있을 때 안전하게 접근하려면 ?.를 씁니다." },
                { context: "Step 14: 데이터 필터링 (LINQ)", preCode: "        var admins = users.", gap: "Where", postCode: "(u => u.IsAdmin);", options: ["Filter", "Select", "Where", "Find"], answer: "Where", explanation: "조건에 맞는 요소를 찾을 때는 LINQ의 Where를 씁니다." },
                { context: "Step 15: 디버그 로그 출력", preCode: "        ", gap: "Console.WriteLine", postCode: "(\"Login Sequence Complete\");", options: ["print", "Console.WriteLine", "Debug.Log", "System.out"], answer: "Console.WriteLine", explanation: "콘솔에 내용을 출력할 때는 Console.WriteLine을 사용합니다." }
            ],
            [LANGUAGES.CPP]: [
                { context: "Step 1: 입출력 스트림 포함", preCode: "#include <", gap: "iostream", postCode: ">", options: ["stdio.h", "iostream", "string", "vector"], answer: "iostream", explanation: "C++ 입출력은 iostream 헤더를 사용합니다." },
                { context: "Step 2: 표준 네임스페이스 사용", preCode: "using namespace ", gap: "std", postCode: ";", options: ["cpp", "std", "stl", "core"], answer: "std", explanation: "표준 라이브러리는 std 네임스페이스 안에 있습니다." },
                { context: "Step 3: 좌표 템플릿 정의 (제네릭)", preCode: "", gap: "template", postCode: " <typename T>\nstruct Vec2 { T x, y; };", options: ["generic", "template", "class", "meta"], answer: "template", explanation: "다양한 타입에 대응하는 구조체는 template으로 만듭니다." },
                { context: "Step 4: 게임 엔티티 클래스", preCode: "class Entity {\npublic:\n    ", gap: "virtual", postCode: " void Update() = 0;", options: ["static", "virtual", "inline", "friend"], answer: "virtual", explanation: "자식 클래스에서 오버라이드할 함수는 virtual로 선언합니다." },
                { context: "Step 5: 플레이어 상속", preCode: "class Player : ", gap: "public", postCode: " Entity {\n    // ...\n};", options: ["extends", "public", "virtual", "super"], answer: "public", explanation: "일반적인 상속 접근 지정자는 public입니다." },
                { context: "Step 6: 정적 멤버 (적 카운트)", preCode: "    ", gap: "static", postCode: " int enemyCount;", options: ["const", "global", "static", "shared"], answer: "static", explanation: "모든 인스턴스가 공유하는 변수는 static입니다." },
                { context: "Step 7: 엔티티 목록 (벡터)", preCode: "#include <vector>\n", gap: "vector", postCode: "<Entity*> entities;", options: ["list", "array", "vector", "deque"], answer: "vector", explanation: "크기가 변하는 배열은 std::vector를 사용합니다." },
                { context: "Step 8: 스마트 포인터 사용", preCode: "#include <memory>\nstd::", gap: "unique_ptr", postCode: "<Player> p = std::make_unique<Player>();", options: ["auto_ptr", "unique_ptr", "smart_ptr", "weak_ptr"], answer: "unique_ptr", explanation: "자동으로 메모리를 해제해주는 스마트 포인터입니다." },
                { context: "Step 9: 자동 타입 추론 반복", preCode: "for (", gap: "auto", postCode: " e : entities) {\n    e->Update();\n}", options: ["var", "let", "auto", "int"], answer: "auto", explanation: "타입을 컴파일러가 알아서 추론하게 하려면 auto를 씁니다." },
                { context: "Step 10: 범위 기반 for문", preCode: "for (int id ", gap: ":", postCode: " activeIds) {\n    // process\n}", options: ["in", ":", "of", "from"], answer: ":", explanation: "컨테이너의 모든 요소를 순회할 때 콜론(:)을 씁니다." },
                { context: "Step 11: 참조자에 의한 전달", preCode: "void Move(Vec2<int>", gap: "&", postCode: " pos) {\n    this->pos = pos;\n}", options: ["*", "&", "ref", "%"], answer: "&", explanation: "복사 비용을 줄이기 위해 참조자(&)를 사용합니다." },
                { context: "Step 12: 멤버 접근 화살표", preCode: "Entity* e = new Player();\ne", gap: "->", postCode: "Update();", options: [".", "->", "::", ":"], answer: "->", explanation: "포인터로 객체 멤버에 접근할 때는 -> 연산자를 씁니다." },
                { context: "Step 13: 사용자 입력 받기", preCode: "char key;\n", gap: "cin", postCode: " >> key;", options: ["cout", "scan", "cin", "get"], answer: "cin", explanation: "C++ 표준 입력 스트림은 cin입니다." },
                { context: "Step 14: 화면 출력", preCode: "", gap: "cout", postCode: " << \"Game Over\" << endl;", options: ["cin", "print", "cout", "out"], answer: "cout", explanation: "C++ 표준 출력 스트림은 cout입니다." },
                { context: "Step 15: 소멸자 정의 (메모리 해제)", preCode: "    ", gap: "~", postCode: "Player() {\n        cout << \"Destroyed\";\n    }", options: ["-", "!", "~", "#"], answer: "~", explanation: "객체가 파괴될 때 호출되는 소멸자는 ~로 시작합니다." }
            ]
        };

        const FILLER_CODE = [
            "import sys; sys.setrecursionlimit(1000)",
            "void* memory = malloc(1024 * 1024);",
            "public static void Main(string[] args) {",
            "template <typename T> class Matrix {",
            "while(true) { process_event(e); }",
            "if (buffer_overflow) return -1;",
            "try { connect_to_server(); } catch(e) {}",
            "const int MAX_USERS = 5000;",
            "// Optimization needed here",
            "return this->value * 0.5f;",
            "await db.SaveChangesAsync();",
            "std::map<string, int> cache;",
            "for(auto it = begin; it != end; ++it)",
            "// TODO: Refactor this mess",
            "docker build -t myapp .",
            "git commit -m 'wip'",
            "npm install react-dom"
        ];

        const ProjectPreview = ({ language, progress, isInteractive }) => {
            const [pyData, setPyData] = useState([40, 70, 50, 90]);
            const [pyLog, setPyLog] = useState(["> Initializing..."]);
            
            const [heroPos, setHeroPos] = useState({ x: 2, y: 3 });
            const [enemyPos, setEnemyPos] = useState({ x: 6, y: 3 });
            const [dungeonLog, setDungeonLog] = useState("");

            const [loginState, setLoginState] = useState('form');

            useEffect(() => {
                if (Math.random() > 0.5) setPyData([60, 30, 80, 45]);
                if (Math.random() > 0.5) setHeroPos({ x: 1, y: 1 });
            }, []);

            const refreshPython = () => {
                if (!isInteractive) return;
                playSound('success');
                const newData = Array.from({length: 4}, () => Math.floor(Math.random() * 80) + 20);
                setPyData(newData);
                setPyLog(prev => [...prev.slice(-4), `> New Batch: [${newData[0]},...]`]);
            };

            const moveHero = (dir) => {
                if (!isInteractive) return;
                let newX = heroPos.x;
                let newY = heroPos.y;
                if (dir === 'L') newX = Math.max(0, newX - 1);
                if (dir === 'R') newX = Math.min(7, newX + 1);
                if (dir === 'U') newY = Math.max(0, newY - 1);
                if (dir === 'D') newY = Math.min(5, newY + 1);

                setHeroPos({ x: newX, y: newY });
                
                if (newX === enemyPos.x && newY === enemyPos.y) {
                    playSound('success');
                    setDungeonLog("ENEMY DEFEATED!");
                    setEnemyPos({ x: -1, y: -1 });
                } else {
                    playSound('fever');
                    setDungeonLog("");
                }
            };

            const tryLogin = () => {
                if (!isInteractive) return;
                setLoginState('processing');
                playSound('fever');
                setTimeout(() => {
                    setLoginState('success');
                    playSound('complete');
                }, 1000);
            };

            const renderPythonDashboard = () => (
                <div className="w-full h-full bg-gray-900 p-4 flex flex-col gap-4 font-mono text-xs border-2 border-gray-700 rounded-lg shadow-inner relative overflow-hidden select-none">
                    <div className="text-green-400 border-b border-gray-700 pb-2 flex justify-between items-center">
                        <span>AI_DASHBOARD.py</span>
                        {isInteractive && <RefreshCw className="w-4 h-4 cursor-pointer hover:rotate-180 transition-transform" onClick={refreshPython} />}
                    </div>
                    
                    <div className="grid grid-cols-2 gap-2 h-full">
                        <div className={`bg-gray-800 rounded p-2 transition-opacity duration-500 ${progress > 20 ? 'opacity-100' : 'opacity-20'}`}>
                            <div className="h-2 w-full bg-gray-700 mb-2"></div>
                            <div className="flex items-end h-16 space-x-1 justify-around">
                                {pyData.map((h, i) => (
                                    <div key={i} style={{ height: `${h}%` }} className="w-2 bg-blue-500 transition-all duration-300"></div>
                                ))}
                            </div>
                        </div>
                        
                        <div className={`bg-gray-800 rounded p-2 flex items-center justify-center transition-opacity duration-500 ${progress > 40 ? 'opacity-100' : 'opacity-20'}`}>
                            {progress >= 100 ? (
                                <div className="text-center text-green-400">
                                    <CheckCircle className="w-8 h-8 mx-auto mb-1" />
                                    <div>READY</div>
                                </div>
                            ) : (
                                <div className="w-10 h-10 rounded-full border-4 border-purple-500 border-t-transparent animate-spin"></div>
                            )}
                        </div>
                        
                        <div className={`col-span-2 bg-black rounded p-2 text-green-500 overflow-hidden font-mono text-[10px] transition-opacity duration-500 ${progress > 60 ? 'opacity-100' : 'opacity-20'}`}>
                            {pyLog.map((l, i) => <div key={i}>{l}</div>)}
                            {progress < 100 && <div className="animate-pulse">_</div>}
                        </div>
                    </div>
                    
                    {isInteractive && (
                        <div className="absolute inset-0 bg-transparent flex items-center justify-center pointer-events-none">
                            <div className="mt-20 text-white/20 text-4xl font-black rotate-[-15deg] pointer-events-auto cursor-pointer" onClick={refreshPython}>CLICK ME</div>
                        </div>
                    )}
                </div>
            );

            const renderCGame = () => (
                <div className="w-full h-full bg-black p-2 font-mono border-4 border-gray-600 rounded-lg relative overflow-hidden select-none">
                    <div className="text-white text-xs text-center mb-2 border-b border-gray-800 pb-1 flex justify-between">
                        <span>DUNGEON.cpp</span>
                        <span className="text-red-500">{dungeonLog}</span>
                    </div>
                    
                    <div className="relative w-full h-[140px] bg-[#1a1a1a] grid grid-cols-8 grid-rows-6 gap-0.5">
                        {Array.from({ length: 48 }).map((_, i) => (
                            <div key={i} className={`border border-white/5 ${progress > 20 ? 'opacity-100' : 'opacity-0'}`}></div>
                        ))}
                        
                        <div 
                            className={`absolute transition-all duration-200 ${progress > 40 ? 'opacity-100' : 'opacity-0'}`}
                            style={{ 
                                left: `calc(${(heroPos.x * 12.5)}% + 6%)`, 
                                top: `calc(${(heroPos.y * 16.6)}% + 8%)` 
                            }}
                        >
                            <div className="w-4 h-4 bg-blue-500 rounded-sm shadow-[0_0_5px_blue]"></div>
                        </div>

                        {enemyPos.x >= 0 && (
                            <div 
                                className={`absolute transition-all duration-200 ${progress > 60 ? 'opacity-100' : 'opacity-0'}`}
                                style={{ 
                                    left: `calc(${(enemyPos.x * 12.5)}% + 6%)`, 
                                    top: `calc(${(enemyPos.y * 16.6)}% + 8%)` 
                                }}
                            >
                                <div className="w-4 h-4 bg-red-600 rounded-sm animate-pulse"></div>
                            </div>
                        )}
                    </div>

                    {isInteractive && (
                        <div className="absolute bottom-2 right-2 grid grid-cols-3 gap-1 opacity-70">
                            <div></div><button className="bg-gray-700 text-white p-1 rounded text-[8px]" onClick={() => moveHero('U')}>▲</button><div></div>
                            <button className="bg-gray-700 text-white p-1 rounded text-[8px]" onClick={() => moveHero('L')}>◀</button>
                            <button className="bg-gray-700 text-white p-1 rounded text-[8px]" onClick={() => moveHero('D')}>▼</button>
                            <button className="bg-gray-700 text-white p-1 rounded text-[8px]" onClick={() => moveHero('R')}>▶</button>
                        </div>
                    )}
                </div>
            );

            const renderCSharpApp = () => (
                <div className="w-full h-full bg-slate-800 p-1 border border-blue-500/50 rounded flex flex-col relative overflow-hidden select-none">
                    <div className="bg-slate-700 text-white text-[10px] p-1 flex justify-between items-center">
                        <span>WinFormApp</span>
                        <div className="flex gap-1"><div className="w-2 h-2 bg-red-500 rounded-full"/></div>
                    </div>
                    
                    {loginState === 'success' ? (
                        <div className="flex-1 bg-white flex flex-col items-center justify-center animate-fade-in">
                            <User className="w-12 h-12 text-blue-500 mb-2" />
                            <div className="text-slate-800 font-bold">Welcome Back!</div>
                            <div className="text-slate-500 text-xs">Admin Access Granted</div>
                        </div>
                    ) : (
                        <div className={`flex-1 bg-slate-200 flex flex-col items-center justify-center p-4 transition-opacity ${progress > 30 ? 'opacity-100' : 'opacity-0'}`}>
                            <div className={`w-full h-6 bg-white rounded mb-2 border border-slate-300 ${progress < 50 && 'invisible'}`} />
                            <div className={`w-full h-6 bg-white rounded mb-4 border border-slate-300 ${progress < 50 && 'invisible'}`} />
                            <button 
                                onClick={tryLogin}
                                disabled={!isInteractive || loginState === 'processing'}
                                className={`w-full h-8 bg-blue-600 text-white rounded font-bold text-xs flex items-center justify-center transition-transform active:scale-95 ${progress < 70 ? 'invisible' : ''} ${!isInteractive ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-500 cursor-pointer shadow-lg'}`}
                            >
                                {loginState === 'processing' ? <RefreshCw className="w-3 h-3 animate-spin"/> : 'LOGIN'}
                            </button>
                        </div>
                    )}
                </div>
            );

            if (language === LANGUAGES.PYTHON) return renderPythonDashboard();
            if (language === LANGUAGES.C || language === LANGUAGES.CPP) return renderCGame();
            return renderCSharpApp();
        };

        function CodeRushGame() {
            const [gameState, setGameState] = useState('menu');
            const [language, setLanguage] = useState(null);
            const [score, setScore] = useState(0);
            const [lives, setLives] = useState(3);
            const [gameQuestions, setGameQuestions] = useState([]);
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [displayCode, setDisplayCode] = useState([]);
            const [typing, setTyping] = useState(false);
            const [feedback, setFeedback] = useState(null);
            
            const [feverGauge, setFeverGauge] = useState(0);
            const [isFeverTime, setIsFeverTime] = useState(false);
            const [feverTimer, setFeverTimer] = useState(0);
            const [buildProgress, setBuildProgress] = useState(0);
            const [attempts, setAttempts] = useState(0);

            const codeEndRef = useRef(null);

            useEffect(() => {
                let interval;
                if (isFeverTime && feverTimer > 0) {
                    interval = setInterval(() => {
                        setFeverTimer(prev => {
                            if (prev <= 1) {
                                setIsFeverTime(false);
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                } else if (feverTimer <= 0) {
                    setIsFeverTime(false);
                }
                return () => clearInterval(interval);
            }, [isFeverTime, feverTimer]);

            const startGame = (lang) => {
                const allQ = QUESTIONS_SOURCE[lang];
                
                setGameQuestions(allQ);
                setLanguage(lang);
                setScore(0);
                setLives(3);
                setCurrentQIndex(0);
                setAttempts(0);
                setDisplayCode([]);
                setGameState('playing');
                setFeverGauge(0);
                setIsFeverTime(false);
                setBuildProgress(0);
                
                triggerTypingEffect(lang, 0, allQ);
            };

            const triggerTypingEffect = (lang, qIndex, questions) => {
                setTyping(true);
                let lines = [];
                let count = 0;
                const maxLines = isFeverTime ? 3 : 6; 

                const interval = setInterval(() => {
                    const randomLine = FILLER_CODE[Math.floor(Math.random() * FILLER_CODE.length)];
                    lines = [...lines, { text: randomLine, type: 'filler' }];
                    setDisplayCode([...lines]);
                    scrollToBottom();
                    
                    count++;
                    if (count >= maxLines) {
                        clearInterval(interval);
                        setTimeout(() => {
                            showQuestion(lang, qIndex, lines, questions);
                        }, isFeverTime ? 200 : 400);
                    }
                }, isFeverTime ? 30 : 60);
            };

            const showQuestion = (lang, qIndex, currentLines, questions) => {
                const q = questions[qIndex];
                if (!q) {
                    endGame(true);
                    return;
                }
                setTyping(false);
                const questionLines = [
                    { text: `// ${q.context}`, type: 'comment' },
                    { text: q.preCode, gap: q.gap, postCode: q.postCode, type: 'question' }
                ];
                setDisplayCode([...currentLines, ...questionLines]);
                scrollToBottom();
            };

            const scrollToBottom = () => {
                if (codeEndRef.current) {
                    codeEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            };

            const getPythonError = (wrongOption) => {
                if (['printf', 'echo', 'write', 'Console.Write', 'include', 'using', 'require', 'push', 'add', 'insert', 'loop', 'xrange', 'list', 'when', 'check', 'case', 'attempt', 'do', 'begin', '__main__', 'start', '__new__', 'file', 'load', 'read', 'has', 'exists', 'contains', 'func', 'arrow', 'every', 'check', 'sum', 'slice', 'divide', 'cut', 'ceil', 'floor', 'fix'].includes(wrongOption)) {
                   return `Traceback (most recent call last):\n  File "<stdin>", line 1, in <module>\nNameError: name '${wrongOption}' is not defined`;
                }
                return `Traceback (most recent call last):\n  File "<stdin>", line 1, in <module>\nSyntaxError: invalid syntax`;
            };

            const handleAnswer = (selectedOption) => {
                const q = gameQuestions[currentQIndex];
                const isCorrect = selectedOption === q.answer;

                if (isCorrect) {
                    playSound(isFeverTime ? 'fever' : 'success');
                    
                    if (attempts === 0) {
                        const baseScore = 100;
                        const multiplier = isFeverTime ? 2 : 1;
                        setScore(s => s + (baseScore * multiplier));
                        
                        if (!isFeverTime) {
                            setFeverGauge(prev => {
                                const newValue = prev + 34; 
                                if (newValue >= 100) {
                                    activateFever();
                                    return 100;
                                }
                                return newValue;
                            });
                        }
                    }

                    const totalQuestions = gameQuestions.length;
                    setBuildProgress(prev => Math.min(prev + (100 / totalQuestions), 100));

                    let msg = "OK. Next block...";
                    if (language === LANGUAGES.PYTHON) {
                        msg = "Execution Result: \n[Success] Module loaded correctly."; 
                    }
                    setFeedback({ correct: true, msg });
                } else {
                    playSound('error');
                    setLives(l => l - 1);
                    setAttempts(prev => prev + 1);
                    setScore(s => Math.max(0, s - 50));
                    
                    if (!isFeverTime) setFeverGauge(0);
                    
                    let msg = "";
                    if (language === LANGUAGES.PYTHON) {
                        msg = getPythonError(selectedOption);
                    } else {
                        msg = `Compilation Error: '${selectedOption}' is not valid in this context.`;
                    }
                    setFeedback({ correct: false, msg });
                }

                setGameState('feedback');
            };

            const activateFever = () => {
                playSound('fever');
                setIsFeverTime(true);
                setFeverTimer(10); 
                setFeverGauge(100);
            };

            const nextQuestion = () => {
                if (lives <= 0) {
                    endGame(false);
                    return;
                }

                const nextIdx = currentQIndex + 1;
                if (nextIdx >= gameQuestions.length) {
                    endGame(true);
                    return;
                }

                setAttempts(0);
                setCurrentQIndex(nextIdx);
                setFeedback(null);
                setGameState('playing');
                triggerTypingEffect(language, nextIdx, gameQuestions);
            };

            const retryQuestion = () => {
                if (lives <= 0) {
                    endGame(false);
                    return;
                }
                setFeedback(null);
                setGameState('playing');
            };

            const endGame = (cleared) => {
                setGameState('gameover');
                if (cleared) {
                    setBuildProgress(100);
                    playSound('complete');
                } else {
                    playSound('error');
                }
                setFeedback({ correct: cleared, msg: cleared ? "Build Complete!" : "Build Failed" });
            };

            const renderMenu = () => (
                <div className="flex flex-col items-center justify-center h-full space-y-8 animate-fade-in relative z-10">
                    <div className="text-center space-y-2">
                        <div className="flex justify-center mb-4">
                            <Terminal className="w-20 h-20 text-green-400 drop-shadow-[0_0_15px_rgba(74,222,128,0.5)]" />
                        </div>
                        <h1 className="text-6xl font-black text-white tracking-tighter italic">
                            CODE <span className="text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500">RUSH</span>
                        </h1>
                        <p className="text-gray-400 text-lg">Select language to start project.</p>
                    </div>

                    <div className="grid grid-cols-2 gap-4 w-full max-w-md">
                        {Object.values(LANGUAGES).map((lang) => (
                            <button
                                key={lang}
                                onClick={() => startGame(lang)}
                                className="group relative flex flex-col items-center p-6 bg-gray-800/80 rounded-xl border-2 border-gray-700 hover:border-green-500 hover:bg-gray-750 transition-all duration-300 shadow-lg hover:shadow-green-500/20 backdrop-blur-sm overflow-hidden"
                            >
                                <Code2 className="w-8 h-8 mb-2 text-gray-400 group-hover:text-green-400 transition-colors" />
                                <span className="text-xl font-bold text-gray-200 group-hover:text-white">{lang}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );

            const renderGame = () => {
                const currentQ = gameQuestions[currentQIndex];

                return (
                    <div className="flex flex-col h-full relative">
                        {isFeverTime && (
                            <div className="absolute inset-0 pointer-events-none z-0 border-[6px] border-yellow-500/50 animate-pulse rounded-xl shadow-[inset_0_0_50px_rgba(234,179,8,0.2)]"></div>
                        )}

                        <div className="flex items-center justify-between p-3 bg-gray-900 border-b border-gray-700 select-none z-10 relative">
                            <div className="flex items-center space-x-4">
                                <span className="text-sm font-mono text-gray-400 ml-2 flex items-center">
                                    <Cpu className="w-4 h-4 mr-2" /> {language} <span className="ml-2 text-gray-500">|</span> <span className="ml-2 text-green-400">Step {currentQIndex + 1}/{gameQuestions.length}</span>
                                </span>
                            </div>
                            
                            <div className="flex flex-col items-center w-1/3">
                                <div className="flex justify-between w-full text-[10px] text-gray-400 font-bold mb-1">
                                    <span>COMBO</span>
                                    {isFeverTime && <span className="text-yellow-400 animate-pulse">FEVER x2</span>}
                                </div>
                                <div className="w-full h-2 bg-gray-800 rounded-full overflow-hidden border border-gray-700 relative">
                                    <div 
                                        className={`h-full transition-all duration-300 ${isFeverTime ? 'bg-gradient-to-r from-yellow-500 to-red-500 animate-pulse' : 'bg-gradient-to-r from-blue-500 to-cyan-400'}`}
                                        style={{ width: `${isFeverTime ? (feverTimer / 10) * 100 : feverGauge}%` }}
                                    />
                                </div>
                            </div>

                            <div className="flex items-center space-x-4 text-sm font-mono font-bold">
                                <div className={`flex items-center transition-transform ${isFeverTime ? 'scale-110 text-yellow-300' : 'text-yellow-500'}`}>
                                    <Trophy className="w-4 h-4 mr-2" />
                                    {score.toLocaleString()}
                                </div>
                                <div className="flex items-center text-red-400">
                                    <Activity className="w-4 h-4 mr-2" />
                                    {'♥'.repeat(Math.max(0, lives))}
                                </div>
                            </div>
                        </div>

                        <div className="flex flex-1 overflow-hidden relative z-10">
                            <div className="flex-1 p-6 overflow-y-auto bg-[#1e1e1e] font-mono text-lg relative custom-scrollbar border-r border-gray-800">
                                {displayCode.map((line, idx) => (
                                    <div key={idx} className={`${line.type === 'filler' ? 'text-gray-600 blur-[0.5px] opacity-70' : ''} mb-1 leading-relaxed`}>
                                        {line.type === 'comment' && (
                                            <span className="text-green-600 italic block mb-1">{line.text}</span>
                                        )}
                                        {line.type === 'question' ? (
                                            <div className="flex flex-wrap items-center bg-gray-800/50 p-1 rounded -ml-1">
                                                <span className="text-blue-400 whitespace-pre-wrap">{line.text}</span>
                                                {gameState === 'feedback' || gameState === 'gameover' ? (
                                                    <span className={`px-2 py-0.5 mx-1 rounded ${feedback?.correct ? 'bg-green-500/20 text-green-400 border border-green-500/50' : 'bg-red-500/20 text-red-400 border border-red-500'} font-bold shadow-lg`}>
                                                        {feedback?.correct ? line.gap : (feedback ? currentQ.answer : line.gap)}
                                                    </span>
                                                ) : (
                                                    <span className="inline-block min-w-[80px] h-7 mx-1 bg-gray-700 border-b-2 border-yellow-400 animate-pulse rounded px-2 text-center text-yellow-200 font-bold">?</span>
                                                )}
                                                <span className="text-blue-400">{line.postCode}</span>
                                            </div>
                                        ) : (
                                            <span className="whitespace-pre-wrap text-gray-300">{line.text}</span>
                                        )}
                                    </div>
                                ))}
                                <div ref={codeEndRef} />
                                
                                {!typing && gameState === 'playing' && currentQ && (
                                    <div className="mt-8 grid grid-cols-2 gap-3 animate-slide-up bg-gray-800/90 p-4 rounded-lg border border-gray-600 backdrop-blur-md sticky bottom-0 shadow-2xl">
                                        {currentQ.options.map((opt, idx) => (
                                            <button
                                                key={idx}
                                                onClick={() => handleAnswer(opt)}
                                                className="group flex items-center px-4 py-3 bg-gray-700/80 hover:bg-blue-600 text-left rounded font-mono text-white transition-all border border-gray-600 hover:border-blue-400 hover:shadow-[0_0_15px_rgba(37,99,235,0.4)] transform hover:-translate-y-0.5"
                                            >
                                                <span className="w-6 h-6 rounded bg-black/30 flex items-center justify-center text-xs text-gray-400 mr-3 group-hover:text-white group-hover:bg-white/20">{String.fromCharCode(65 + idx)}</span>
                                                <span className="text-lg">{opt}</span>
                                            </button>
                                        ))}
                                    </div>
                                )}

                                {gameState === 'feedback' && (
                                    language === LANGUAGES.PYTHON ? (
                                        <div className="mt-8 bg-[#2d2d2d] rounded-lg border border-gray-600 animate-slide-up sticky bottom-0 shadow-2xl font-mono text-sm overflow-hidden">
                                            <div className="flex">
                                                <div className={`w-2 ${feedback.correct ? 'bg-blue-500' : 'bg-red-500'}`}></div>
                                                <div className="flex-1 p-4">
                                                    {feedback.correct ? (
                                                        <>
                                                            <div className="text-gray-400 mb-1">Out[{currentQIndex + 1}]:</div>
                                                            <div className="text-white whitespace-pre-wrap">{feedback.msg}</div>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <div className="text-red-400 mb-1">Error:</div>
                                                            <div className="text-red-300 whitespace-pre-wrap">{feedback.msg}</div>
                                                        </>
                                                    )}
                                                </div>
                                            </div>
                                            {feedback.correct ? (
                                                <button onClick={nextQuestion} className="w-full flex items-center justify-center px-4 py-2 bg-gray-700 hover:bg-gray-600 hover:text-white text-gray-300 text-xs font-bold transition-all border-t border-gray-600">
                                                    CONTINUE <Play className="w-3 h-3 ml-2 fill-current" />
                                                </button>
                                            ) : (
                                                <button onClick={lives > 0 ? retryQuestion : () => endGame(false)} className="w-full flex items-center justify-center px-4 py-2 bg-red-900/50 hover:bg-red-900 hover:text-white text-red-300 text-xs font-bold transition-all border-t border-red-900">
                                                    {lives > 0 ? "TRY AGAIN (Retry)" : "GAME OVER"} <RotateCcw className="w-3 h-3 ml-2" />
                                                </button>
                                            )}
                                        </div>
                                    ) : (
                                        <div className={`mt-8 p-6 rounded-lg border backdrop-blur-md animate-slide-up sticky bottom-0 shadow-2xl ${feedback.correct ? 'bg-green-900/40 border-green-500' : 'bg-red-900/40 border-red-500'}`}>
                                            <div className="flex items-start">
                                                {feedback.correct ? <CheckCircle className="w-8 h-8 text-green-400 mr-4" /> : <XCircle className="w-8 h-8 text-red-400 mr-4" />}
                                                <div className="flex-1">
                                                    <h3 className={`text-xl font-black mb-1 ${feedback.correct ? 'text-green-300' : 'text-red-300'}`}>{feedback.correct ? "SUCCESS" : "ERROR"}</h3>
                                                    <p className="text-gray-200 mb-4 text-sm font-sans opacity-90">{feedback.msg}</p>
                                                    {feedback.correct ? (
                                                        <button onClick={nextQuestion} className="w-full flex items-center justify-center px-4 py-3 bg-gray-700 hover:bg-gray-600 hover:text-white rounded text-gray-200 text-sm font-bold transition-all border border-gray-600 hover:border-gray-400">
                                                            CONTINUE <Play className="w-4 h-4 ml-2 fill-current" />
                                                        </button>
                                                    ) : (
                                                        <button onClick={lives > 0 ? retryQuestion : () => endGame(false)} className="w-full flex items-center justify-center px-4 py-3 bg-red-800 hover:bg-red-700 hover:text-white rounded text-gray-200 text-sm font-bold transition-all border border-red-700 hover:border-red-500">
                                                            {lives > 0 ? "TRY AGAIN" : "GAME OVER"} <RotateCcw className="w-4 h-4 ml-2" />
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    )
                                )}
                            </div>

                            <div className="hidden lg:flex w-1/3 bg-gray-900 border-l border-gray-800 flex-col">
                                <div className="p-3 border-b border-gray-800 bg-gray-800 text-xs font-bold text-gray-400 flex items-center">
                                    <Monitor className="w-4 h-4 mr-2" /> LIVE PREVIEW
                                </div>
                                <div className="flex-1 p-6 flex items-center justify-center bg-gray-950/50">
                                    <div className="w-full aspect-square max-w-[300px]">
                                        <ProjectPreview language={language} progress={buildProgress} isInteractive={false} />
                                    </div>
                                </div>
                                <div className="h-1/3 bg-black border-t border-gray-800 p-3 font-mono text-[10px] text-gray-500 overflow-hidden">
                                    <div>{'>'} Building... {Math.floor(buildProgress)}%</div>
                                    {buildProgress >= 100 && <div className="text-green-500">{'>'} BUILD SUCCESSFUL.</div>}
                                    <div className="animate-pulse">_</div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderGameOver = () => {
                const isSuccess = lives > 0;
                return (
                    <div className="flex flex-col items-center justify-center h-full animate-fade-in text-center p-8 z-10 relative bg-gray-900/90">
                        <h2 className="text-4xl font-black text-white mb-6">
                            {isSuccess ? "DEPLOYMENT SUCCESSFUL" : "DEPLOYMENT FAILED"}
                        </h2>
                        
                        <div className="flex gap-8 items-start w-full max-w-4xl">
                            <div className="flex-1 bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-2xl">
                                <div className="mb-6 flex justify-center">
                                    {isSuccess ? <Trophy className="w-20 h-20 text-yellow-400" /> : <XCircle className="w-20 h-20 text-red-500" />}
                                </div>
                                <div className="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                                    <span className="text-gray-400">Score</span>
                                    <span className="font-black text-yellow-400 text-2xl">{score.toLocaleString()}</span>
                                </div>
                                <div className="flex justify-between items-center mb-6">
                                    <span className="text-gray-400">Language</span>
                                    <span className="font-bold text-blue-400">{language}</span>
                                </div>
                                <button
                                    onClick={() => setGameState('menu')}
                                    className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 rounded-lg font-bold text-white shadow-lg transition-transform hover:scale-105"
                                >
                                    TRY AGAIN
                                </button>
                            </div>

                            {isSuccess && (
                                <div className="flex-1 flex flex-col items-center animate-slide-up">
                                    <div className="bg-black p-1 rounded-lg border-4 border-green-500 shadow-[0_0_20px_rgba(34,197,94,0.3)] w-full aspect-square max-w-[320px] relative">
                                        <ProjectPreview language={language} progress={100} isInteractive={true} />
                                    </div>
                                    <div className="mt-4 text-green-400 font-mono text-sm animate-pulse">
                                        ▲ INTERACTIVE MODE ACTIVATED ▲
                                    </div>
                                    <div className="text-gray-500 text-xs mt-1">
                                        (Try clicking buttons or moving characters!)
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            return (
                <div className="w-full max-w-6xl h-[90vh] bg-[#151515] rounded-2xl shadow-2xl overflow-hidden border border-gray-800 flex flex-col relative ring-1 ring-white/5 z-0 mx-auto my-8">
                    {gameState === 'menu' && renderMenu()}
                    {(gameState === 'playing' || gameState === 'feedback') && renderGame()}
                    {gameState === 'gameover' && renderGameOver()}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CodeRushGame />);
    </script>
</body>
</html>